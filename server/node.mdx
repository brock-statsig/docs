---
title: Legacy Node.js Server SDK
sidebarTitle: Legacy Node.js
description: Statsig's Legacy Server SDK for Node.js applications
icon: "node-js"
---

import installation from '/snippets/server/node/installation.mdx'
import initialization from '/snippets/server/node/initialization.mdx'
import checkGate from '/snippets/server/node/checkGate.mdx'
import getDynamicConfig from '/snippets/server/node/getDynamicConfig.mdx'
import getExperiment from '/snippets/server/node/getExperiment.mdx'
import logEvent from '/snippets/server/node/logEvent.mdx'
import getFeatureGate from '/snippets/server/node/getFeatureGate.mdx'
import statsigOptions from '/snippets/server/node/statsigOptions.mdx'
import shutdown from '/snippets/server/node/shutdown.mdx'
import flush from '/snippets/server/node/flush.mdx'
import clientInitResponse from '/snippets/server/node/clientInitResponse.mdx'
import manualExposures from '/snippets/server/node/manualExposures.mdx'
import localOverrides from '/snippets/server/node/localOverrides.mdx'
import persistentStorageInterface from '/snippets/server/node/persistentStorageInterface.mdx'
import persistentStorageExample from '/snippets/server/node/persistentStorageExample.mdx'
import multiInstance from '/snippets/server/node/multiInstance.mdx'
import forwardProxy from '/snippets/server/node/forwardProxy.mdx'
import cloudflare from '/snippets/server/node/cloudflare.mdx'
import faqs from '/snippets/server/node/faqs.mdx'

[Github Repository](https://github.com/statsig-io/node-js-server-sdk)

## Setup the SDK

<Steps>
<Step title="Install the SDK">
<installation/>
</Step>
<Step title="Initialize the SDK">
<initialization/>
</Step>
</Steps>

## Working with the SDK

<checkGate/>
<getDynamicConfig/>
<getExperiment/>
<getFeatureGate/>
<logEvent/>

## Statsig User

When calling APIs that require a user, you should pass as much information as possible in order to take advantage of advanced gate and config conditions (like country or OS/browser level checks), and correctly measure impact of your experiments on your metrics/events. At least one identifier, either userID or a Custom ID, is required to provide a consistent experience for a given user (as explained [here](/concepts/user#why-is-an-id-always-required-for-server-sdks)).

Besides `userID`, we also have `email`, `ip`, `userAgent`, `country`, `locale` and `appVersion` as top-level fields on StatsigUser. In addition, you can pass any key-value pairs in an object/dictionary to the `custom` field and be able to create targeting based on them.

Note that while typing is lenient on the `StatsigUser` object to allow you to pass in numbers, strings, arrays, objects, and potentially even enums or classes, the evaluation operators will only be able to operate on primitive types - mostly strings and numbers. While we attempt to smartly cast custom field types to match the operator, we cannot guarantee evaluation results for other types. For example, setting an array as a custom field will only ever be compared as a string - there is no operator to match a value in that array.

### Private Attributes

Have sensitive user PII data that should not be logged? No problem, we have a solution for it! On the StatsigUser object we also have a field called `privateAttributes`, which is a simple object/dictionary that you can use to set private user attributes. Any attribute set in `privateAttributes` will only be used for evaluation/targeting, and removed from any logs before they are sent to Statsig server.

For example, if you have feature gates that should only pass for users with emails ending in "@statsig.com", but do not want to log your users' email addresses to Statsig, you can simply add the key-value pair `{ email: "my_user@statsig.com" }` to `privateAttributes` on the user and that's it!

<statsigOptions/>

<shutdown/>
<flush/>

<clientInitResponse/>

<localOverrides/>

<manualExposures/>

<cloudflare/>

<persistentStorageInterface/>
<persistentStorageExample/>

<multiInstance/>

<forwardProxy/>

<faqs/>

## Reference

### Type StatsigUser

```typescript
export type StatsigUser =
  // at least one of userID or customIDs must be provided
  ({ userID: string } | { customIDs: Record<string, string> }) & {
    userID?: string;
    customIDs?: Record<string, string>;
    email?: string;
    ip?: string;
    userAgent?: string;
    country?: string;
    locale?: string;
    appVersion?: string;
    custom?: Record<
      string,
      string | number | boolean | Array<string> | undefined
    >;
    privateAttributes?: Record<
      string,
      string | number | boolean | Array<string> | undefined
    > | null;
    statsigEnvironment?: StatsigEnvironment;
  }
```

### Type StatsigOptions

```typescript
export type StatsigOptions = {
  api: string;
  apiForDownloadConfigSpecs: string;
  apiForGetIdLists: string;
  bootstrapValues: string | null;
  environment: StatsigEnvironment | null;
  rulesUpdatedCallback: RulesUpdatedCallback | null;
  logger: LoggerInterface;
  localMode: boolean;
  initTimeoutMs: number;
  dataAdapter: IDataAdapter | null;
  rulesetsSyncIntervalMs: number;
  idListsSyncIntervalMs: number;
  loggingIntervalMs: number;
  loggingMaxBufferSize: number;
  disableDiagnostics: boolean;
  initStrategyForIP3Country: InitStrategy;
  initStrategyForIDLists: InitStrategy;
  postLogsRetryLimit: number;
  postLogsRetryBackoff: RetryBackoffFunc | number;
  disableRulesetsSync: boolean;
  disableIdListsSync: boolean;
  disableAllLogging: boolean;
};

export type RulesUpdatedCallback = (rulesJSON: string, time: number) => void;
export type RetryBackoffFunc = (retriesRemaining: number) => number;

export type StatsigEnvironment = {
  tier?: 'production' | 'staging' | 'development' | string;
  [key: string]: string | undefined;
};

export type InitStrategy = 'await' | 'lazy' | 'none';

export interface LoggerInterface {
  debug?(message?: any, ...optionalParams: any[]): void;
  info?(message?: any, ...optionalParams: any[]): void;
  warn(message?: any, ...optionalParams: any[]): void;
  error(message?: any, ...optionalParams: any[]): void;
  logLevel: 'none' | 'debug' | 'info' | 'warn' | 'error';
}
```

### Type FeatureGate

```typescript
export type FeatureGate = {
  readonly name: string;
  readonly ruleID: string;
  readonly idType: string | null;
  readonly value: boolean;
  readonly evaluationDetails: EvaluationDetails | null;
  readonly groupName: null; // deprecated
};
```

### Type DynamicConfig

```typescript
export default class DynamicConfig {
  name: string;
  value: Record<string, unknown>;
  get<T>(
    key: string,
    defaultValue: T,
    typeGuard: ((value: unknown) => value is T | null) | null = null,
  ): T;
  getValue(
    key: string,
    defaultValue?: boolean | number | string | object | Array<any> | null,
  ): unknown | null;
  getRuleID(): string;
  getGroupName(): string | null;
  getIDType(): string | null;
  getEvaluationDetails(): EvaluationDetails | null;
```

### Type Layer

```typescript
export default class Layer {
  name: string;
  public get<T>(
    key: string,
    defaultValue: T,
    typeGuard: ((value: unknown) => value is T) | null = null,
  ): T;
  getValue(
    key: string,
    defaultValue?: boolean | number | string | object | Array<any> | null,
  ): unknown | null;
  getRuleID(): string;
  getGroupName(): string | null;
  getAllocatedExperimentName(): string | null;
  getEvaluationDetails(): EvaluationDetails | null;
```

### DataAdapter

```typescript
export interface IDataAdapter {
  get(key: string): Promise<AdapterResponse>;
  set(key: string, value: string, time?: number): Promise<void>;
  initialize(): Promise<void>;
  shutdown(): Promise<void>;
  supportsPollingUpdatesFor(key: DataAdapterKey): boolean;
}
```

### EvaluationDetails

```typescript
export class EvaluationDetails {
  readonly configSyncTime: number;
  readonly initTime: number;
  readonly serverTime: number;
  readonly reason: EvaluationReason;
}
```

### EvaluationReason

```typescript
export type EvaluationReason =
  | 'Network'
  | 'LocalOverride'
  | 'Unrecognized'
  | 'Uninitialized'
  | 'Bootstrap'
  | 'DataAdapter'
  | 'Unsupported';
```


